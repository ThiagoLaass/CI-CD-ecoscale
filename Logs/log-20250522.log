2025-05-22 00:13:05.667 -03:00 [INF] Swagger UI available at http://localhost:5051/swagger/index.html
2025-05-22 00:13:05.739 -03:00 [INF] Server starting and listening on http://0.0.0.0:5051
2025-05-22 00:13:05.756 -03:00 [INF] User profile is available. Using 'C:\Users\thiag\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 00:13:05.809 -03:00 [INF] Now listening on: http://0.0.0.0:5051
2025-05-22 00:13:05.811 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 00:13:05.812 -03:00 [INF] Hosting environment: Development
2025-05-22 00:13:05.813 -03:00 [INF] Content root path: G:\repos\pmg-es-2025-1-ti4-3170100-pesquisa-bh-tec\Codigo\backend\EcoScale
2025-05-22 00:13:11.943 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/Auth/login - application/json 69
2025-05-22 00:13:12.001 -03:00 [INF] Request from: []
2025-05-22 00:13:12.571 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 00:13:12.589 -03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] LoginAsync(EcoScale.src.Public.DTOs.LoginRequest) on controller EcoScale.src.Controllers.AuthController (EcoScale).
2025-05-22 00:13:14.480 -03:00 [ERR] An error occurred using the connection to database '${DB_USERNAME}' on server 'tcp://localhost:5432'.
2025-05-22 00:13:14.498 -03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'EcoScale.src.Data.AppDbContext'.
Npgsql.PostgresException (0x80004005): 28P01: autentica��o do tipo senha falhou para o usu�rio "postgres"
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.AuthenticateSASL(List`1 mechanisms, String username, Boolean async, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.Authenticate(String username, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|214_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: FATAL
    SqlState: 28P01
    MessageText: autentica��o do tipo senha falhou para o usu�rio "postgres"
    File: auth.c
    Line: 324
    Routine: auth_failed
Npgsql.PostgresException (0x80004005): 28P01: autentica��o do tipo senha falhou para o usu�rio "postgres"
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.Internal.NpgsqlConnector.AuthenticateSASL(List`1 mechanisms, String username, Boolean async, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.Authenticate(String username, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.<Open>g__OpenCore|214_1(NpgsqlConnector conn, SslMode sslMode, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.Internal.NpgsqlConnector.Open(NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.OpenNewConnector(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.PoolingDataSource.<Get>g__RentAsync|33_0(NpgsqlConnection conn, NpgsqlTimeout timeout, Boolean async, CancellationToken cancellationToken)
   at Npgsql.NpgsqlConnection.<Open>g__OpenAsync|42_0(Boolean async, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternalAsync(Boolean errorsExpected, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenAsync(CancellationToken cancellationToken, Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
  Exception data:
    Severity: FATAL
    SqlState: 28P01
    MessageText: autentica��o do tipo senha falhou para o usu�rio "postgres"
    File: auth.c
    Line: 324
    Routine: auth_failed
2025-05-22 00:13:14.520 -03:00 [INF] Executed action EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale) in 1926.837ms
2025-05-22 00:13:14.531 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 00:13:14.559 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/Auth/login - 500 null application/json 2616.999ms
2025-05-22 00:16:22.189 -03:00 [INF] Application is shutting down...
2025-05-22 00:24:24.636 -03:00 [INF] Swagger UI available at http://localhost:5051/swagger/index.html
2025-05-22 00:24:24.704 -03:00 [INF] Server starting and listening on http://0.0.0.0:5051
2025-05-22 00:24:24.720 -03:00 [INF] User profile is available. Using 'C:\Users\thiag\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 00:24:24.772 -03:00 [INF] Now listening on: http://0.0.0.0:5051
2025-05-22 00:24:24.774 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 00:24:24.775 -03:00 [INF] Hosting environment: Development
2025-05-22 00:24:24.776 -03:00 [INF] Content root path: G:\repos\pmg-es-2025-1-ti4-3170100-pesquisa-bh-tec\codigo\backend\EcoScale
2025-05-22 00:24:29.256 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/Auth/login - application/json 69
2025-05-22 00:24:29.318 -03:00 [INF] Request from: []
2025-05-22 00:24:29.392 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 00:24:29.408 -03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] LoginAsync(EcoScale.src.Public.DTOs.LoginRequest) on controller EcoScale.src.Controllers.AuthController (EcoScale).
2025-05-22 00:24:31.156 -03:00 [INF] Executed DbCommand (60ms) [Parameters=[@__request_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u.usuario_id, u.email, u.boo_email_confirmado, u.role, u.senha, e.cnpj, e.dsc_empresa, e.endereco_sede, e.foto_perfil_mime, e.foto_perfil, e.boo_removida, e.num_telefone, e.razao_social, e.setor_atuacao, e.responsavel_id, m.nome, CASE
    WHEN m.usuario_id IS NOT NULL THEN 'Moderador'
    WHEN e.usuario_id IS NOT NULL THEN 'Empresa'
END AS "Discriminator"
FROM usuario AS u
LEFT JOIN empresa AS e ON u.usuario_id = e.usuario_id
LEFT JOIN moderador AS m ON u.usuario_id = m.usuario_id
WHERE u.email = @__request_Email_0
LIMIT 2
2025-05-22 00:24:31.304 -03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType18`1[[EcoScale.src.Public.DTOs.LoginResponse, EcoScale, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 00:24:31.322 -03:00 [INF] Executed action EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale) in 1909.5124ms
2025-05-22 00:24:31.327 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 00:24:31.341 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/Auth/login - 200 null application/json; charset=utf-8 2086.6738ms
2025-05-22 00:34:24.348 -03:00 [INF] Application is shutting down...
2025-05-22 00:34:31.838 -03:00 [INF] Swagger UI available at http://localhost:5051/swagger/index.html
2025-05-22 00:34:31.901 -03:00 [INF] Server starting and listening on http://0.0.0.0:5051
2025-05-22 00:34:31.917 -03:00 [INF] User profile is available. Using 'C:\Users\thiag\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 00:34:31.968 -03:00 [INF] Now listening on: http://0.0.0.0:5051
2025-05-22 00:34:31.969 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 00:34:31.970 -03:00 [INF] Hosting environment: Development
2025-05-22 00:34:31.971 -03:00 [INF] Content root path: G:\repos\pmg-es-2025-1-ti4-3170100-pesquisa-bh-tec\codigo\backend\EcoScale
2025-05-22 00:35:23.004 -03:00 [INF] Application is shutting down...
2025-05-22 00:35:27.108 -03:00 [INF] Swagger UI available at http://localhost:5051/swagger/index.html
2025-05-22 00:35:27.173 -03:00 [INF] Server starting and listening on http://0.0.0.0:5051
2025-05-22 00:35:27.188 -03:00 [INF] User profile is available. Using 'C:\Users\thiag\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 00:35:27.239 -03:00 [INF] Now listening on: http://0.0.0.0:5051
2025-05-22 00:35:27.241 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 00:35:27.242 -03:00 [INF] Hosting environment: Development
2025-05-22 00:35:27.242 -03:00 [INF] Content root path: G:\repos\pmg-es-2025-1-ti4-3170100-pesquisa-bh-tec\codigo\backend\EcoScale
2025-05-22 00:35:29.631 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/Auth/login - application/json 69
2025-05-22 00:35:29.683 -03:00 [INF] Request from: []
2025-05-22 00:35:29.698 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 00:35:29.713 -03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] LoginAsync(EcoScale.src.Public.DTOs.LoginRequest) on controller EcoScale.src.Controllers.AuthController (EcoScale).
2025-05-22 00:35:30.773 -03:00 [INF] Executed DbCommand (39ms) [Parameters=[@__request_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u.usuario_id, u.email, u.boo_email_confirmado, u.role, u.senha, e.cnpj, e.dsc_empresa, e.endereco_sede, e.foto_perfil_mime, e.foto_perfil, e.boo_removida, e.num_telefone, e.razao_social, e.setor_atuacao, e.responsavel_id, m.nome, CASE
    WHEN m.usuario_id IS NOT NULL THEN 'Moderador'
    WHEN e.usuario_id IS NOT NULL THEN 'Empresa'
END AS "Discriminator"
FROM usuario AS u
LEFT JOIN empresa AS e ON u.usuario_id = e.usuario_id
LEFT JOIN moderador AS m ON u.usuario_id = m.usuario_id
WHERE u.email = @__request_Email_0
LIMIT 2
2025-05-22 00:35:30.865 -03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType18`1[[EcoScale.src.Public.DTOs.LoginResponse, EcoScale, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 00:35:30.881 -03:00 [INF] Executed action EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale) in 1163.2956ms
2025-05-22 00:35:30.885 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 00:35:30.892 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/Auth/login - 200 null application/json; charset=utf-8 1262.3197ms
2025-05-22 00:36:35.294 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/Auth/login - application/json 69
2025-05-22 00:36:35.297 -03:00 [INF] Request from: []
2025-05-22 00:36:35.299 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 00:36:35.300 -03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] LoginAsync(EcoScale.src.Public.DTOs.LoginRequest) on controller EcoScale.src.Controllers.AuthController (EcoScale).
2025-05-22 00:36:35.373 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u.usuario_id, u.email, u.boo_email_confirmado, u.role, u.senha, e.cnpj, e.dsc_empresa, e.endereco_sede, e.foto_perfil_mime, e.foto_perfil, e.boo_removida, e.num_telefone, e.razao_social, e.setor_atuacao, e.responsavel_id, m.nome, CASE
    WHEN m.usuario_id IS NOT NULL THEN 'Moderador'
    WHEN e.usuario_id IS NOT NULL THEN 'Empresa'
END AS "Discriminator"
FROM usuario AS u
LEFT JOIN empresa AS e ON u.usuario_id = e.usuario_id
LEFT JOIN moderador AS m ON u.usuario_id = m.usuario_id
WHERE u.email = @__request_Email_0
LIMIT 2
2025-05-22 00:36:38.958 -03:00 [INF] Executed DbCommand (38ms) [Parameters=[@p0='?', @p1='?' (DbType = Boolean), @p2='?' (DbType = DateTime), @p3='?' (DbType = Boolean), @p4='?' (DbType = DateTime), @p5='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO email_confirmacao (num_codigo, boo_confirmado, created_at, boo_excluido, expires_at, ref_id)
VALUES (@p0, @p1, @p2, @p3, @p4, @p5)
RETURNING "Id";
2025-05-22 00:36:38.974 -03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType18`1[[EcoScale.src.Public.DTOs.LoginResponse, EcoScale, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 00:36:38.976 -03:00 [INF] Executed action EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale) in 3674.7507ms
2025-05-22 00:36:38.978 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 00:36:38.979 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/Auth/login - 200 null application/json; charset=utf-8 3686.2555ms
2025-05-22 00:36:53.024 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/Auth/email-confirmation - application/json 67
2025-05-22 00:36:53.027 -03:00 [INF] Request from: []
2025-05-22 00:36:53.029 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.AuthController.CompanyEmailConfirmation (EcoScale)'
2025-05-22 00:36:53.033 -03:00 [INF] Route matched with {action = "CompanyEmailConfirmation", controller = "Auth"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult CompanyEmailConfirmation(EcoScale.src.Public.DTOs.EmailConfirmationRequest) on controller EcoScale.src.Controllers.AuthController (EcoScale).
2025-05-22 00:36:53.100 -03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u.usuario_id, u.email, u.boo_email_confirmado, u.role, u.senha, e.cnpj, e.dsc_empresa, e.endereco_sede, e.foto_perfil_mime, e.foto_perfil, e.boo_removida, e.num_telefone, e.razao_social, e.setor_atuacao, e.responsavel_id, m.nome, CASE
    WHEN m.usuario_id IS NOT NULL THEN 'Moderador'
    WHEN e.usuario_id IS NOT NULL THEN 'Empresa'
END AS "Discriminator"
FROM usuario AS u
LEFT JOIN empresa AS e ON u.usuario_id = e.usuario_id
LEFT JOIN moderador AS m ON u.usuario_id = m.usuario_id
WHERE u.email = @__request_Email_0
LIMIT 1
2025-05-22 00:36:53.123 -03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
UPDATE usuario SET boo_email_confirmado = @p0
WHERE usuario_id = @p1;
2025-05-22 00:36:53.139 -03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__refId_0='?', @__now_1='?' (DbType = DateTime)], CommandType='"Text"', CommandTimeout='30']
SELECT e."Id", e.num_codigo, e.boo_confirmado, e.created_at, e.boo_excluido, e.expires_at, e.ref_id
FROM email_confirmacao AS e
WHERE NOT (e.boo_excluido) AND e.ref_id = @__refId_0 AND NOT (e.boo_confirmado) AND e.expires_at > @__now_1
LIMIT 1
2025-05-22 00:36:53.179 -03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__refId_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u.usuario_id, u.email, u.boo_email_confirmado, u.role, u.senha, e.cnpj, e.dsc_empresa, e.endereco_sede, e.foto_perfil_mime, e.foto_perfil, e.boo_removida, e.num_telefone, e.razao_social, e.setor_atuacao, e.responsavel_id, m.nome, CASE
    WHEN m.usuario_id IS NOT NULL THEN 'Moderador'
    WHEN e.usuario_id IS NOT NULL THEN 'Empresa'
END AS "Discriminator"
FROM usuario AS u
LEFT JOIN empresa AS e ON u.usuario_id = e.usuario_id
LEFT JOIN moderador AS m ON u.usuario_id = m.usuario_id
WHERE u.usuario_id::text = @__refId_0
LIMIT 1
2025-05-22 00:36:53.182 -03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?' (DbType = Int32), @p0='?' (DbType = Boolean), @p1='?' (DbType = Boolean)], CommandType='"Text"', CommandTimeout='30']
UPDATE email_confirmacao SET boo_confirmado = @p0, boo_excluido = @p1
WHERE "Id" = @p2;
2025-05-22 00:36:53.185 -03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType19`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-05-22 00:36:53.187 -03:00 [INF] Executed action EcoScale.src.Controllers.AuthController.CompanyEmailConfirmation (EcoScale) in 152.186ms
2025-05-22 00:36:53.188 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.AuthController.CompanyEmailConfirmation (EcoScale)'
2025-05-22 00:36:53.189 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/Auth/email-confirmation - 200 null application/json; charset=utf-8 164.3624ms
2025-05-22 00:37:55.387 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/Empresa/new - application/json 406
2025-05-22 00:37:55.389 -03:00 [INF] Request from: []
2025-05-22 00:37:55.390 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.EmpresaController.New (EcoScale)'
2025-05-22 00:37:55.392 -03:00 [INF] Route matched with {action = "New", controller = "Empresa"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] New(EcoScale.src.Public.DTOs.CompanyCreationRequest) on controller EcoScale.src.Controllers.EmpresaController (EcoScale).
2025-05-22 00:37:55.553 -03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__cpf_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM responsavel_empresa AS r
    WHERE r.cpf = @__cpf_0)
2025-05-22 00:37:55.559 -03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__cnpj_0='?', @__email_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM usuario AS u
    INNER JOIN empresa AS e ON u.usuario_id = e.usuario_id
    WHERE e.cnpj = @__cnpj_0 OR u.email = @__email_1)
2025-05-22 00:37:55.615 -03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?', @p1='?', @p2='?', @p3='?', @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO responsavel_empresa (cpf, nome, telefone)
VALUES (@p0, @p1, @p2)
RETURNING responsavel_empresa_id;
INSERT INTO usuario (email, boo_email_confirmado, role, senha)
VALUES (@p3, @p4, @p5, @p6)
RETURNING usuario_id;
2025-05-22 00:37:55.627 -03:00 [ERR] Failed executing DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p8='?', @p9='?', @p10='?', @p11='?', @p12='?' (DbType = Binary), @p13='?' (DbType = Boolean), @p14='?', @p15='?', @p16='?', @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO empresa (usuario_id, cnpj, dsc_empresa, endereco_sede, foto_perfil_mime, foto_perfil, boo_removida, num_telefone, razao_social, setor_atuacao, responsavel_id)
VALUES (@p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
2025-05-22 00:37:55.663 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'EcoScale.src.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: o valor nulo na coluna "setor_atuacao" da relação "empresa" viola a restrição de não-nulo

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERRO
    SqlState: 23502
    MessageText: o valor nulo na coluna "setor_atuacao" da relação "empresa" viola a restrição de não-nulo
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: empresa
    ColumnName: setor_atuacao
    File: execMain.c
    Line: 1988
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: o valor nulo na coluna "setor_atuacao" da relação "empresa" viola a restrição de não-nulo

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERRO
    SqlState: 23502
    MessageText: o valor nulo na coluna "setor_atuacao" da relação "empresa" viola a restrição de não-nulo
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: empresa
    ColumnName: setor_atuacao
    File: execMain.c
    Line: 1988
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-05-22 00:37:55.681 -03:00 [INF] Executed action EcoScale.src.Controllers.EmpresaController.New (EcoScale) in 287.4574ms
2025-05-22 00:37:55.682 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.EmpresaController.New (EcoScale)'
2025-05-22 00:37:55.690 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/Empresa/new - 500 null application/json 302.2976ms
2025-05-22 00:38:42.647 -03:00 [INF] Application is shutting down...
2025-05-22 00:38:47.138 -03:00 [INF] Swagger UI available at http://localhost:5051/swagger/index.html
2025-05-22 00:38:47.197 -03:00 [INF] Server starting and listening on http://0.0.0.0:5051
2025-05-22 00:38:47.212 -03:00 [INF] User profile is available. Using 'C:\Users\thiag\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 00:38:47.261 -03:00 [INF] Now listening on: http://0.0.0.0:5051
2025-05-22 00:38:47.263 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 00:38:47.264 -03:00 [INF] Hosting environment: Development
2025-05-22 00:38:47.264 -03:00 [INF] Content root path: G:\repos\pmg-es-2025-1-ti4-3170100-pesquisa-bh-tec\codigo\backend\EcoScale
2025-05-22 00:38:47.819 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/Empresa/new - application/json 406
2025-05-22 00:38:47.864 -03:00 [INF] Request from: []
2025-05-22 00:38:47.880 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.EmpresaController.New (EcoScale)'
2025-05-22 00:38:47.897 -03:00 [INF] Route matched with {action = "New", controller = "Empresa"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] New(EcoScale.src.Public.DTOs.CompanyCreationRequest) on controller EcoScale.src.Controllers.EmpresaController (EcoScale).
2025-05-22 00:38:48.989 -03:00 [INF] Executed DbCommand (33ms) [Parameters=[@__cpf_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM responsavel_empresa AS r
    WHERE r.cpf = @__cpf_0)
2025-05-22 00:38:49.018 -03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__cnpj_0='?', @__email_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM usuario AS u
    INNER JOIN empresa AS e ON u.usuario_id = e.usuario_id
    WHERE e.cnpj = @__cnpj_0 OR u.email = @__email_1)
2025-05-22 00:38:49.194 -03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?', @p1='?', @p2='?', @p3='?', @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO responsavel_empresa (cpf, nome, telefone)
VALUES (@p0, @p1, @p2)
RETURNING responsavel_empresa_id;
INSERT INTO usuario (email, boo_email_confirmado, role, senha)
VALUES (@p3, @p4, @p5, @p6)
RETURNING usuario_id;
2025-05-22 00:38:49.214 -03:00 [ERR] Failed executing DbCommand (7ms) [Parameters=[@p7='?' (DbType = Int32), @p8='?', @p9='?', @p10='?', @p11='?', @p12='?' (DbType = Binary), @p13='?' (DbType = Boolean), @p14='?', @p15='?', @p16='?', @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO empresa (usuario_id, cnpj, dsc_empresa, endereco_sede, foto_perfil_mime, foto_perfil, boo_removida, num_telefone, razao_social, setor_atuacao, responsavel_id)
VALUES (@p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
2025-05-22 00:38:49.243 -03:00 [ERR] An exception occurred in the database while saving changes for context type 'EcoScale.src.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: o valor nulo na coluna "setor_atuacao" da relação "empresa" viola a restrição de não-nulo

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERRO
    SqlState: 23502
    MessageText: o valor nulo na coluna "setor_atuacao" da relação "empresa" viola a restrição de não-nulo
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: empresa
    ColumnName: setor_atuacao
    File: execMain.c
    Line: 1988
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: o valor nulo na coluna "setor_atuacao" da relação "empresa" viola a restrição de não-nulo

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERRO
    SqlState: 23502
    MessageText: o valor nulo na coluna "setor_atuacao" da relação "empresa" viola a restrição de não-nulo
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: empresa
    ColumnName: setor_atuacao
    File: execMain.c
    Line: 1988
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-05-22 00:38:49.267 -03:00 [INF] Executed action EcoScale.src.Controllers.EmpresaController.New (EcoScale) in 1367.0658ms
2025-05-22 00:38:49.272 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.EmpresaController.New (EcoScale)'
2025-05-22 00:38:49.294 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/Empresa/new - 500 null application/json 1475.869ms
2025-05-22 00:38:50.973 -03:00 [INF] Application is shutting down...
2025-05-22 00:39:31.509 -03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-05-22 00:39:31.860 -03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);
2025-05-22 00:39:31.867 -03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-05-22 00:39:31.870 -03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
LOCK TABLE "__EFMigrationsHistory" IN ACCESS EXCLUSIVE MODE
2025-05-22 00:39:31.872 -03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-05-22 00:39:31.879 -03:00 [INF] Applying migration '20250522033919_fix_empres'.
2025-05-22 00:39:31.919 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE empresa ALTER COLUMN setor_atuacao DROP NOT NULL;
2025-05-22 00:39:31.921 -03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250522033919_fix_empres', '9.0.3');
2025-05-22 00:39:39.907 -03:00 [INF] Swagger UI available at http://localhost:5051/swagger/index.html
2025-05-22 00:39:39.980 -03:00 [INF] Server starting and listening on http://0.0.0.0:5051
2025-05-22 00:39:40.001 -03:00 [INF] User profile is available. Using 'C:\Users\thiag\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 00:39:40.057 -03:00 [INF] Now listening on: http://0.0.0.0:5051
2025-05-22 00:39:40.059 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 00:39:40.060 -03:00 [INF] Hosting environment: Development
2025-05-22 00:39:40.060 -03:00 [INF] Content root path: G:\repos\pmg-es-2025-1-ti4-3170100-pesquisa-bh-tec\codigo\backend\EcoScale
2025-05-22 00:39:41.892 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/Empresa/new - application/json 406
2025-05-22 00:39:41.946 -03:00 [INF] Request from: []
2025-05-22 00:39:41.964 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.EmpresaController.New (EcoScale)'
2025-05-22 00:39:41.979 -03:00 [INF] Route matched with {action = "New", controller = "Empresa"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] New(EcoScale.src.Public.DTOs.CompanyCreationRequest) on controller EcoScale.src.Controllers.EmpresaController (EcoScale).
2025-05-22 00:39:43.021 -03:00 [INF] Executed DbCommand (30ms) [Parameters=[@__cpf_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM responsavel_empresa AS r
    WHERE r.cpf = @__cpf_0)
2025-05-22 00:39:43.045 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__cnpj_0='?', @__email_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM usuario AS u
    INNER JOIN empresa AS e ON u.usuario_id = e.usuario_id
    WHERE e.cnpj = @__cnpj_0 OR u.email = @__email_1)
2025-05-22 00:39:43.241 -03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?', @p1='?', @p2='?', @p3='?', @p4='?' (DbType = Boolean), @p5='?' (DbType = Int32), @p6='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO responsavel_empresa (cpf, nome, telefone)
VALUES (@p0, @p1, @p2)
RETURNING responsavel_empresa_id;
INSERT INTO usuario (email, boo_email_confirmado, role, senha)
VALUES (@p3, @p4, @p5, @p6)
RETURNING usuario_id;
2025-05-22 00:39:43.255 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p7='?' (DbType = Int32), @p8='?', @p9='?', @p10='?', @p11='?', @p12='?' (DbType = Binary), @p13='?' (DbType = Boolean), @p14='?', @p15='?', @p16='?', @p17='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO empresa (usuario_id, cnpj, dsc_empresa, endereco_sede, foto_perfil_mime, foto_perfil, boo_removida, num_telefone, razao_social, setor_atuacao, responsavel_id)
VALUES (@p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17);
2025-05-22 00:39:43.327 -03:00 [INF] Executing CreatedAtActionResult, writing value of type '<>f__AnonymousType18`1[[EcoScale.src.Public.DTOs.CreationResponse`1[[EcoScale.src.Models.Empresa, EcoScale, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], EcoScale, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 00:39:43.381 -03:00 [INF] Executed action EcoScale.src.Controllers.EmpresaController.New (EcoScale) in 1399.1461ms
2025-05-22 00:39:43.388 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.EmpresaController.New (EcoScale)'
2025-05-22 00:39:43.398 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/Empresa/new - 201 null application/json; charset=utf-8 1507.1914ms
2025-05-22 00:40:02.977 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/Empresa/new - text/plain 406
2025-05-22 00:40:02.981 -03:00 [INF] Request from: []
2025-05-22 00:40:02.983 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.EmpresaController.New (EcoScale)'
2025-05-22 00:40:02.984 -03:00 [INF] Route matched with {action = "New", controller = "Empresa"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] New(EcoScale.src.Public.DTOs.CompanyCreationRequest) on controller EcoScale.src.Controllers.EmpresaController (EcoScale).
2025-05-22 00:40:02.995 -03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-05-22 00:40:03.012 -03:00 [INF] Executed action EcoScale.src.Controllers.EmpresaController.New (EcoScale) in 26.8888ms
2025-05-22 00:40:03.014 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.EmpresaController.New (EcoScale)'
2025-05-22 00:40:03.015 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/Empresa/new - 415 null application/problem+json; charset=utf-8 37.5715ms
2025-05-22 00:40:30.669 -03:00 [INF] Application is shutting down...
2025-05-22 00:41:22.803 -03:00 [INF] Swagger UI available at http://localhost:5051/swagger/index.html
2025-05-22 00:41:22.866 -03:00 [INF] Server starting and listening on http://0.0.0.0:5051
2025-05-22 00:41:22.882 -03:00 [INF] User profile is available. Using 'C:\Users\thiag\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 00:41:22.934 -03:00 [INF] Now listening on: http://0.0.0.0:5051
2025-05-22 00:41:22.937 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 00:41:22.937 -03:00 [INF] Hosting environment: Development
2025-05-22 00:41:22.938 -03:00 [INF] Content root path: G:\repos\pmg-es-2025-1-ti4-3170100-pesquisa-bh-tec\codigo\backend\EcoScale
2025-05-22 00:42:36.780 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/Empresa/new - application/json 406
2025-05-22 00:42:36.855 -03:00 [INF] Request from: []
2025-05-22 00:42:36.870 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.EmpresaController.New (EcoScale)'
2025-05-22 00:42:36.885 -03:00 [INF] Route matched with {action = "New", controller = "Empresa"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] New(EcoScale.src.Public.DTOs.CompanyCreationRequest) on controller EcoScale.src.Controllers.EmpresaController (EcoScale).
2025-05-22 00:42:37.872 -03:00 [INF] Executed DbCommand (29ms) [Parameters=[@__cpf_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM responsavel_empresa AS r
    WHERE r.cpf = @__cpf_0)
2025-05-22 00:42:37.897 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__cnpj_0='?', @__email_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1
    FROM usuario AS u
    INNER JOIN empresa AS e ON u.usuario_id = e.usuario_id
    WHERE e.cnpj = @__cnpj_0 OR u.email = @__email_1)
2025-05-22 00:42:37.906 -03:00 [INF] Executed action EcoScale.src.Controllers.EmpresaController.New (EcoScale) in 1017.5813ms
2025-05-22 00:42:37.910 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.EmpresaController.New (EcoScale)'
2025-05-22 00:42:37.932 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/Empresa/new - 409 null application/json 1152.4742ms
2025-05-22 00:43:29.941 -03:00 [INF] Application is shutting down...
2025-05-22 00:44:00.441 -03:00 [INF] Swagger UI available at http://localhost:5051/swagger/index.html
2025-05-22 00:44:00.501 -03:00 [INF] Server starting and listening on http://0.0.0.0:5051
2025-05-22 00:44:00.516 -03:00 [INF] User profile is available. Using 'C:\Users\thiag\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 00:44:00.562 -03:00 [INF] Now listening on: http://0.0.0.0:5051
2025-05-22 00:44:00.564 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 00:44:00.564 -03:00 [INF] Hosting environment: Development
2025-05-22 00:44:00.565 -03:00 [INF] Content root path: G:\repos\pmg-es-2025-1-ti4-3170100-pesquisa-bh-tec\codigo\backend\EcoScale
2025-05-22 00:46:48.295 -03:00 [INF] Application is shutting down...
2025-05-22 00:57:03.410 -03:00 [INF] Swagger UI available at http://localhost:5051/swagger/index.html
2025-05-22 00:57:03.471 -03:00 [INF] Server starting and listening on http://0.0.0.0:5051
2025-05-22 00:57:03.486 -03:00 [INF] User profile is available. Using 'C:\Users\thiag\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 00:57:03.536 -03:00 [INF] Now listening on: http://0.0.0.0:5051
2025-05-22 00:57:03.539 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 00:57:03.539 -03:00 [INF] Hosting environment: Development
2025-05-22 00:57:03.540 -03:00 [INF] Content root path: G:\repos\pmg-es-2025-1-ti4-3170100-pesquisa-bh-tec\codigo\backend\EcoScale
2025-05-22 00:57:06.686 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/Auth/login - application/json 69
2025-05-22 00:57:06.728 -03:00 [INF] Request from: []
2025-05-22 00:57:06.741 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 00:57:06.755 -03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] LoginAsync(EcoScale.src.Public.DTOs.LoginRequest) on controller EcoScale.src.Controllers.AuthController (EcoScale).
2025-05-22 00:57:07.664 -03:00 [INF] Executed DbCommand (36ms) [Parameters=[@__request_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u.usuario_id, u.email, u.boo_email_confirmado, u.role, u.senha, e.cnpj, e.dsc_empresa, e.endereco_sede, e.foto_perfil_mime, e.foto_perfil, e.boo_removida, e.num_telefone, e.razao_social, e.setor_atuacao, e.responsavel_id, m.nome, CASE
    WHEN m.usuario_id IS NOT NULL THEN 'Moderador'
    WHEN e.usuario_id IS NOT NULL THEN 'Empresa'
END AS "Discriminator"
FROM usuario AS u
LEFT JOIN empresa AS e ON u.usuario_id = e.usuario_id
LEFT JOIN moderador AS m ON u.usuario_id = m.usuario_id
WHERE u.email = @__request_Email_0
LIMIT 2
2025-05-22 00:57:07.757 -03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType18`1[[EcoScale.src.Public.DTOs.LoginResponse, EcoScale, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 00:57:07.770 -03:00 [INF] Executed action EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale) in 1012.4318ms
2025-05-22 00:57:07.774 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 00:57:07.780 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/Auth/login - 200 null application/json; charset=utf-8 1094.9314ms
2025-05-22 00:57:22.797 -03:00 [INF] Request starting HTTP/1.1 PATCH http://localhost:5051/Empresa/patch - application/json 456664
2025-05-22 00:57:22.800 -03:00 [INF] Request from: []
2025-05-22 00:57:22.868 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.EmpresaController.Patch (EcoScale)'
2025-05-22 00:57:22.872 -03:00 [INF] Route matched with {action = "Patch", controller = "Empresa"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Patch(EcoScale.src.Public.DTOs.CompanyUpdateRequest) on controller EcoScale.src.Controllers.EmpresaController (EcoScale).
2025-05-22 00:57:23.106 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u.usuario_id, u.email, u.boo_email_confirmado, u.role, u.senha, e.cnpj, e.dsc_empresa, e.endereco_sede, e.foto_perfil_mime, e.foto_perfil, e.boo_removida, e.num_telefone, e.razao_social, e.setor_atuacao, e.responsavel_id, r.responsavel_empresa_id, r.cpf, r.nome, r.telefone
FROM usuario AS u
INNER JOIN empresa AS e ON u.usuario_id = e.usuario_id
INNER JOIN responsavel_empresa AS r ON e.responsavel_id = r.responsavel_empresa_id
WHERE u.email = @__email_0
LIMIT 1
2025-05-22 00:57:23.257 -03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p10='?' (DbType = Int32), @p0='?', @p1='?', @p2='?', @p3='?', @p4='?' (DbType = Binary), @p5='?' (DbType = Boolean), @p6='?', @p7='?', @p8='?', @p9='?' (DbType = Int32), @p15='?' (DbType = Int32), @p11='?', @p12='?' (DbType = Boolean), @p13='?' (DbType = Int32), @p14='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE empresa SET cnpj = @p0, dsc_empresa = @p1, endereco_sede = @p2, foto_perfil_mime = @p3, foto_perfil = @p4, boo_removida = @p5, num_telefone = @p6, razao_social = @p7, setor_atuacao = @p8, responsavel_id = @p9
WHERE usuario_id = @p10;
UPDATE usuario SET email = @p11, boo_email_confirmado = @p12, role = @p13, senha = @p14
WHERE usuario_id = @p15;
2025-05-22 00:57:23.271 -03:00 [INF] Executing OkObjectResult, writing value of type 'EcoScale.src.Models.Empresa'.
2025-05-22 00:57:23.293 -03:00 [INF] Executed action EcoScale.src.Controllers.EmpresaController.Patch (EcoScale) in 419.3723ms
2025-05-22 00:57:23.294 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.EmpresaController.Patch (EcoScale)'
2025-05-22 00:57:23.296 -03:00 [INF] Request finished HTTP/1.1 PATCH http://localhost:5051/Empresa/patch - 200 null application/json; charset=utf-8 499.4064ms
2025-05-22 00:58:15.022 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/Auth/login - application/json 66
2025-05-22 00:58:15.026 -03:00 [INF] Request from: []
2025-05-22 00:58:15.028 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 00:58:15.029 -03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] LoginAsync(EcoScale.src.Public.DTOs.LoginRequest) on controller EcoScale.src.Controllers.AuthController (EcoScale).
2025-05-22 00:58:15.075 -03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u.usuario_id, u.email, u.boo_email_confirmado, u.role, u.senha, e.cnpj, e.dsc_empresa, e.endereco_sede, e.foto_perfil_mime, e.foto_perfil, e.boo_removida, e.num_telefone, e.razao_social, e.setor_atuacao, e.responsavel_id, m.nome, CASE
    WHEN m.usuario_id IS NOT NULL THEN 'Moderador'
    WHEN e.usuario_id IS NOT NULL THEN 'Empresa'
END AS "Discriminator"
FROM usuario AS u
LEFT JOIN empresa AS e ON u.usuario_id = e.usuario_id
LEFT JOIN moderador AS m ON u.usuario_id = m.usuario_id
WHERE u.email = @__request_Email_0
LIMIT 2
2025-05-22 00:58:15.080 -03:00 [INF] Executed action EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale) in 50.1228ms
2025-05-22 00:58:15.081 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 00:58:15.086 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/Auth/login - 500 null application/json 63.2981ms
2025-05-22 00:58:41.183 -03:00 [INF] Application is shutting down...
2025-05-22 00:59:18.673 -03:00 [INF] Swagger UI available at http://localhost:5051/swagger/index.html
2025-05-22 00:59:18.746 -03:00 [INF] Server starting and listening on http://0.0.0.0:5051
2025-05-22 00:59:18.762 -03:00 [INF] User profile is available. Using 'C:\Users\thiag\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 00:59:18.818 -03:00 [INF] Now listening on: http://0.0.0.0:5051
2025-05-22 00:59:18.820 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 00:59:18.821 -03:00 [INF] Hosting environment: Development
2025-05-22 00:59:18.821 -03:00 [INF] Content root path: G:\repos\pmg-es-2025-1-ti4-3170100-pesquisa-bh-tec\codigo\backend\EcoScale
2025-05-22 01:02:49.884 -03:00 [INF] Application is shutting down...
2025-05-22 01:02:53.923 -03:00 [INF] Swagger UI available at http://localhost:5051/swagger/index.html
2025-05-22 01:02:53.981 -03:00 [INF] Server starting and listening on http://0.0.0.0:5051
2025-05-22 01:02:53.998 -03:00 [INF] User profile is available. Using 'C:\Users\thiag\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 01:02:54.048 -03:00 [INF] Now listening on: http://0.0.0.0:5051
2025-05-22 01:02:54.050 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 01:02:54.051 -03:00 [INF] Hosting environment: Development
2025-05-22 01:02:54.052 -03:00 [INF] Content root path: G:\repos\pmg-es-2025-1-ti4-3170100-pesquisa-bh-tec\codigo\backend\EcoScale
2025-05-22 01:02:57.196 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/api/moderador/new - application/json 128
2025-05-22 01:02:57.240 -03:00 [INF] Request from: []
2025-05-22 01:02:57.256 -03:00 [INF] Authorization failed. These requirements were not met:
RolesAuthorizationRequirement:User.IsInRole must be true for one of the following roles: (Moderador)
2025-05-22 01:02:57.294 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/api/moderador/new - 401 null application/json 99.7853ms
2025-05-22 01:03:08.144 -03:00 [INF] Application is shutting down...
2025-05-22 01:03:13.306 -03:00 [INF] Swagger UI available at http://localhost:5051/swagger/index.html
2025-05-22 01:03:13.373 -03:00 [INF] Server starting and listening on http://0.0.0.0:5051
2025-05-22 01:03:13.393 -03:00 [INF] User profile is available. Using 'C:\Users\thiag\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 01:03:13.445 -03:00 [INF] Now listening on: http://0.0.0.0:5051
2025-05-22 01:03:13.447 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 01:03:13.448 -03:00 [INF] Hosting environment: Development
2025-05-22 01:03:13.448 -03:00 [INF] Content root path: G:\repos\pmg-es-2025-1-ti4-3170100-pesquisa-bh-tec\codigo\backend\EcoScale
2025-05-22 01:03:15.868 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/api/moderador/new - application/json 128
2025-05-22 01:03:15.920 -03:00 [INF] Request from: []
2025-05-22 01:03:15.934 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.ModeradorController.New (EcoScale)'
2025-05-22 01:03:15.949 -03:00 [INF] Route matched with {action = "New", controller = "Moderador"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] New(EcoScale.src.Public.DTOs.ModeradorCreationRequest) on controller EcoScale.src.Controllers.ModeradorController (EcoScale).
2025-05-22 01:03:16.901 -03:00 [INF] Executed DbCommand (42ms) [Parameters=[@p0='?', @p1='?' (DbType = Boolean), @p2='?' (DbType = Int32), @p3='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO usuario (email, boo_email_confirmado, role, senha)
VALUES (@p0, @p1, @p2, @p3)
RETURNING usuario_id;
2025-05-22 01:03:16.934 -03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p4='?' (DbType = Int32), @p5='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO moderador (usuario_id, nome)
VALUES (@p4, @p5);
2025-05-22 01:03:16.969 -03:00 [INF] Executing CreatedAtActionResult, writing value of type '<>f__AnonymousType18`1[[EcoScale.src.Public.DTOs.CreationResponse`1[[EcoScale.src.Models.Moderador, EcoScale, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], EcoScale, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 01:03:17.004 -03:00 [INF] Executed action EcoScale.src.Controllers.ModeradorController.New (EcoScale) in 1051.166ms
2025-05-22 01:03:17.009 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.ModeradorController.New (EcoScale)'
2025-05-22 01:03:17.016 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/api/moderador/new - 201 null application/json; charset=utf-8 1149.6716ms
2025-05-22 01:03:38.304 -03:00 [INF] Application is shutting down...
2025-05-22 01:04:15.930 -03:00 [INF] Swagger UI available at http://localhost:5051/swagger/index.html
2025-05-22 01:04:15.991 -03:00 [INF] Server starting and listening on http://0.0.0.0:5051
2025-05-22 01:04:16.007 -03:00 [INF] User profile is available. Using 'C:\Users\thiag\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-05-22 01:04:16.057 -03:00 [INF] Now listening on: http://0.0.0.0:5051
2025-05-22 01:04:16.059 -03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-05-22 01:04:16.060 -03:00 [INF] Hosting environment: Development
2025-05-22 01:04:16.061 -03:00 [INF] Content root path: G:\repos\pmg-es-2025-1-ti4-3170100-pesquisa-bh-tec\codigo\backend\EcoScale
2025-05-22 01:04:16.603 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/api/moderador/new - application/json 128
2025-05-22 01:04:16.644 -03:00 [INF] Request from: []
2025-05-22 01:04:16.661 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.ModeradorController.New (EcoScale)'
2025-05-22 01:04:16.675 -03:00 [INF] Route matched with {action = "New", controller = "Moderador"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] New(EcoScale.src.Public.DTOs.ModeradorCreationRequest) on controller EcoScale.src.Controllers.ModeradorController (EcoScale).
2025-05-22 01:04:17.592 -03:00 [INF] Executed DbCommand (32ms) [Parameters=[@p0='?', @p1='?' (DbType = Boolean), @p2='?' (DbType = Int32), @p3='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO usuario (email, boo_email_confirmado, role, senha)
VALUES (@p0, @p1, @p2, @p3)
RETURNING usuario_id;
2025-05-22 01:04:17.615 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p4='?' (DbType = Int32), @p5='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO moderador (usuario_id, nome)
VALUES (@p4, @p5);
2025-05-22 01:04:17.659 -03:00 [INF] Executing CreatedAtActionResult, writing value of type '<>f__AnonymousType18`1[[EcoScale.src.Public.DTOs.CreationResponse`1[[EcoScale.src.Models.Moderador, EcoScale, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], EcoScale, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 01:04:17.699 -03:00 [INF] Executed action EcoScale.src.Controllers.ModeradorController.New (EcoScale) in 1021.0033ms
2025-05-22 01:04:17.703 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.ModeradorController.New (EcoScale)'
2025-05-22 01:04:17.710 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/api/moderador/new - 201 null application/json; charset=utf-8 1108.2914ms
2025-05-22 01:04:35.273 -03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5051/Auth/login - application/json 66
2025-05-22 01:04:35.276 -03:00 [INF] Request from: []
2025-05-22 01:04:35.279 -03:00 [INF] Executing endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 01:04:35.284 -03:00 [INF] Route matched with {action = "Login", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] LoginAsync(EcoScale.src.Public.DTOs.LoginRequest) on controller EcoScale.src.Controllers.AuthController (EcoScale).
2025-05-22 01:04:35.498 -03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_Email_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u.usuario_id, u.email, u.boo_email_confirmado, u.role, u.senha, e.cnpj, e.dsc_empresa, e.endereco_sede, e.foto_perfil_mime, e.foto_perfil, e.boo_removida, e.num_telefone, e.razao_social, e.setor_atuacao, e.responsavel_id, m.nome, CASE
    WHEN m.usuario_id IS NOT NULL THEN 'Moderador'
    WHEN e.usuario_id IS NOT NULL THEN 'Empresa'
END AS "Discriminator"
FROM usuario AS u
LEFT JOIN empresa AS e ON u.usuario_id = e.usuario_id
LEFT JOIN moderador AS m ON u.usuario_id = m.usuario_id
WHERE u.email = @__request_Email_0
LIMIT 2
2025-05-22 01:04:35.511 -03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType18`1[[EcoScale.src.Public.DTOs.LoginResponse, EcoScale, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-05-22 01:04:35.513 -03:00 [INF] Executed action EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale) in 226.9746ms
2025-05-22 01:04:35.514 -03:00 [INF] Executed endpoint 'EcoScale.src.Controllers.AuthController.LoginAsync (EcoScale)'
2025-05-22 01:04:35.516 -03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5051/Auth/login - 200 null application/json; charset=utf-8 242.1522ms
2025-05-22 01:04:41.401 -03:00 [INF] Application is shutting down...
